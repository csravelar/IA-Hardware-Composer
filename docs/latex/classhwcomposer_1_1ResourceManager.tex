\hypertarget{classhwcomposer_1_1ResourceManager}{}\section{hwcomposer\+:\+:Resource\+Manager Class Reference}
\label{classhwcomposer_1_1ResourceManager}\index{hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}}


{\ttfamily \#include $<$resourcemanager.\+h$>$}

\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classhwcomposer_1_1ResourceManager_aa22da4e56a203700e5b43ec46d670768}{Resource\+Manager}} (\mbox{\hyperlink{classhwcomposer_1_1NativeBufferHandler}{Native\+Buffer\+Handler}} $\ast$buffer\+\_\+handler)
\item 
\mbox{\hyperlink{classhwcomposer_1_1ResourceManager_a2b0726e34c5f2f9e8e832fe0aab5bddf}{$\sim$\+Resource\+Manager}} ()
\item 
void \mbox{\hyperlink{classhwcomposer_1_1ResourceManager_ade81dca6fb55a8e36f07802c6d9153d9}{Dump}} ()
\item 
std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classhwcomposer_1_1OverlayBuffer}{Overlay\+Buffer}} $>$ \& \mbox{\hyperlink{classhwcomposer_1_1ResourceManager_a011efc96d68e84a7a093b066078d76bb}{Find\+Cached\+Buffer}} (const uint32\+\_\+t \&native\+\_\+buffer)
\item 
void \mbox{\hyperlink{classhwcomposer_1_1ResourceManager_a7e086990e56fcf24ab2fbc47d677dcce}{Register\+Buffer}} (const uint32\+\_\+t \&native\+\_\+buffer, std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classhwcomposer_1_1OverlayBuffer}{Overlay\+Buffer}} $>$ \&p\+Buffer)
\item 
void \mbox{\hyperlink{classhwcomposer_1_1ResourceManager_aed72efa73f3037049b1328ea35f162b3}{Mark\+Resource\+For\+Deletion}} (const \mbox{\hyperlink{namespacehwcomposer_a963c5a1d5902d2d05710dba19af35b48}{Resource\+Handle}} \&handle, bool has\+\_\+valid\+\_\+gpu\+\_\+resources)
\item 
void \mbox{\hyperlink{classhwcomposer_1_1ResourceManager_a0813f1ac50652ca59c3f4b03291dd4b4}{Mark\+Media\+Resource\+For\+Deletion}} (const \mbox{\hyperlink{namespacehwcomposer_aa99e35835961ac7d6baa59a04131ff42}{Media\+Resource\+Handle}} \&handle)
\item 
void \mbox{\hyperlink{classhwcomposer_1_1ResourceManager_a303f37d04b5a8aa1aa91f579ed897b33}{Refresh\+Buffer\+Cache}} ()
\item 
void \mbox{\hyperlink{classhwcomposer_1_1ResourceManager_afda313d41d4a7d91f2c8e7fe99779f11}{Get\+Purged\+Resources}} (std\+::vector$<$ \mbox{\hyperlink{namespacehwcomposer_a963c5a1d5902d2d05710dba19af35b48}{Resource\+Handle}} $>$ \&gl\+\_\+resources, std\+::vector$<$ \mbox{\hyperlink{namespacehwcomposer_aa99e35835961ac7d6baa59a04131ff42}{Media\+Resource\+Handle}} $>$ \&media\+\_\+resources, bool $\ast$has\+\_\+gpu\+\_\+resource)
\item 
void \mbox{\hyperlink{classhwcomposer_1_1ResourceManager_ab30302bab7dc3e8609a431299e16a8f4}{Purge\+Buffer}} ()
\item 
bool \mbox{\hyperlink{classhwcomposer_1_1ResourceManager_a7ffb53b713befaf75975e667d21f1612}{Prepare\+Purged\+Resources}} ()
\item 
const \mbox{\hyperlink{classhwcomposer_1_1NativeBufferHandler}{Native\+Buffer\+Handler}} $\ast$ \mbox{\hyperlink{classhwcomposer_1_1ResourceManager_a3835ffcbf6c6ca862ad72744c95d087d}{Get\+Native\+Buffer\+Handler}} () const
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 58 of file resourcemanager.\+h.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classhwcomposer_1_1ResourceManager_aa22da4e56a203700e5b43ec46d670768}\label{classhwcomposer_1_1ResourceManager_aa22da4e56a203700e5b43ec46d670768}} 
\index{hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}!Resource\+Manager@{Resource\+Manager}}
\index{Resource\+Manager@{Resource\+Manager}!hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}}
\subsubsection{\texorpdfstring{Resource\+Manager()}{ResourceManager()}}
{\footnotesize\ttfamily hwcomposer\+::\+Resource\+Manager\+::\+Resource\+Manager (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classhwcomposer_1_1NativeBufferHandler}{Native\+Buffer\+Handler}} $\ast$}]{buffer\+\_\+handler }\end{DoxyParamCaption})}



Definition at line 21 of file resourcemanager.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{22     : buffer\_handler\_(buffer\_handler) \{}
\DoxyCodeLine{23   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < \mbox{\hyperlink{resourcemanager_8h_ae64672166a8df80d8c41841e07d839e1}{BUFFER\_CACHE\_LENGTH}}; i++)}
\DoxyCodeLine{24     cached\_buffers\_.emplace\_back();}
\DoxyCodeLine{25 \}}
\end{DoxyCode}
\mbox{\Hypertarget{classhwcomposer_1_1ResourceManager_a2b0726e34c5f2f9e8e832fe0aab5bddf}\label{classhwcomposer_1_1ResourceManager_a2b0726e34c5f2f9e8e832fe0aab5bddf}} 
\index{hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}!````~Resource\+Manager@{$\sim$\+Resource\+Manager}}
\index{````~Resource\+Manager@{$\sim$\+Resource\+Manager}!hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}}
\subsubsection{\texorpdfstring{$\sim$\+Resource\+Manager()}{~ResourceManager()}}
{\footnotesize\ttfamily hwcomposer\+::\+Resource\+Manager\+::$\sim$\+Resource\+Manager (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 27 of file resourcemanager.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{27                                   \{}
\DoxyCodeLine{28   \textcolor{keywordflow}{if} (!cached\_buffers\_.empty()) \{}
\DoxyCodeLine{29     \mbox{\hyperlink{alios_2platformdefines_8h_a226d6c99e4bcfca193c095e085e9097d}{ETRACE}}(\textcolor{stringliteral}{"ResourceManager destroyed with valid native resources \(\backslash\)n"});}
\DoxyCodeLine{30   \}}
\DoxyCodeLine{31 }
\DoxyCodeLine{32   \textcolor{keywordflow}{if} (!purged\_resources\_.empty() || !destroy\_gl\_resources\_.empty()) \{}
\DoxyCodeLine{33     \mbox{\hyperlink{alios_2platformdefines_8h_a226d6c99e4bcfca193c095e085e9097d}{ETRACE}}(\textcolor{stringliteral}{"ResourceManager destroyed with valid 3D resources \(\backslash\)n"});}
\DoxyCodeLine{34   \}}
\DoxyCodeLine{35 }
\DoxyCodeLine{36   \textcolor{keywordflow}{if} (!purged\_media\_resources\_.empty() || !destroy\_media\_resources\_.empty()) \{}
\DoxyCodeLine{37     \mbox{\hyperlink{alios_2platformdefines_8h_a226d6c99e4bcfca193c095e085e9097d}{ETRACE}}(\textcolor{stringliteral}{"ResourceManager destroyed with valid Media resources \(\backslash\)n"});}
\DoxyCodeLine{38   \}}
\DoxyCodeLine{39 \}}
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classhwcomposer_1_1ResourceManager_ade81dca6fb55a8e36f07802c6d9153d9}\label{classhwcomposer_1_1ResourceManager_ade81dca6fb55a8e36f07802c6d9153d9}} 
\index{hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}!Dump@{Dump}}
\index{Dump@{Dump}!hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}}
\subsubsection{\texorpdfstring{Dump()}{Dump()}}
{\footnotesize\ttfamily void hwcomposer\+::\+Resource\+Manager\+::\+Dump (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 49 of file resourcemanager.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{49                            \{}
\DoxyCodeLine{50 \}}
\end{DoxyCode}
\mbox{\Hypertarget{classhwcomposer_1_1ResourceManager_a011efc96d68e84a7a093b066078d76bb}\label{classhwcomposer_1_1ResourceManager_a011efc96d68e84a7a093b066078d76bb}} 
\index{hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}!Find\+Cached\+Buffer@{Find\+Cached\+Buffer}}
\index{Find\+Cached\+Buffer@{Find\+Cached\+Buffer}!hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}}
\subsubsection{\texorpdfstring{Find\+Cached\+Buffer()}{FindCachedBuffer()}}
{\footnotesize\ttfamily std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classhwcomposer_1_1OverlayBuffer}{Overlay\+Buffer}} $>$ \& hwcomposer\+::\+Resource\+Manager\+::\+Find\+Cached\+Buffer (\begin{DoxyParamCaption}\item[{const uint32\+\_\+t \&}]{native\+\_\+buffer }\end{DoxyParamCaption})}



Definition at line 52 of file resourcemanager.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{53                                    \{}
\DoxyCodeLine{54   BUFFER\_MAP\& first\_map = cached\_buffers\_[0];}
\DoxyCodeLine{55   \textcolor{keyword}{static} std::shared\_ptr<OverlayBuffer> pBufNull = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{56   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\& map : cached\_buffers\_) \{}
\DoxyCodeLine{57     \textcolor{keywordflow}{if} (map.empty()) \{}
\DoxyCodeLine{58       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{59     \}}
\DoxyCodeLine{60 }
\DoxyCodeLine{61     BUFFER\_MAP::iterator it = map.find(native\_buffer);}
\DoxyCodeLine{62 }
\DoxyCodeLine{63     \textcolor{keywordflow}{if} (it != map.end()) \{}
\DoxyCodeLine{64       std::shared\_ptr<OverlayBuffer>\& pBuf = it->second;}
\DoxyCodeLine{65       \textcolor{keywordflow}{if} (\&map != \&first\_map) \{}
\DoxyCodeLine{66         first\_map.emplace(std::make\_pair(native\_buffer, pBuf));}
\DoxyCodeLine{67       \}}
\DoxyCodeLine{68 \textcolor{preprocessor}{\#ifdef RESOURCE\_CACHE\_TRACING}}
\DoxyCodeLine{69       hit\_count\_++;}
\DoxyCodeLine{70 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{71       \textcolor{keywordflow}{return} pBuf;}
\DoxyCodeLine{72     \}}
\DoxyCodeLine{73   \}}
\DoxyCodeLine{74 }
\DoxyCodeLine{75 \textcolor{preprocessor}{\#ifdef RESOURCE\_CACHE\_TRACING}}
\DoxyCodeLine{76   miss\_count\_++;}
\DoxyCodeLine{77   \textcolor{keywordflow}{if} (miss\_count\_ \% 100 == 0)}
\DoxyCodeLine{78     \mbox{\hyperlink{hwctrace_8h_a6221b5741097c2ba515a4f2f4937ce9d}{ICACHETRACE}}(\textcolor{stringliteral}{"cache miss count is \%llu, while hit count is \%llu"},}
\DoxyCodeLine{79                 miss\_count\_, hit\_count\_);}
\DoxyCodeLine{80 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{81 }
\DoxyCodeLine{82   \textcolor{keywordflow}{return} pBufNull;}
\DoxyCodeLine{83 \}}
\end{DoxyCode}
\mbox{\Hypertarget{classhwcomposer_1_1ResourceManager_a3835ffcbf6c6ca862ad72744c95d087d}\label{classhwcomposer_1_1ResourceManager_a3835ffcbf6c6ca862ad72744c95d087d}} 
\index{hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}!Get\+Native\+Buffer\+Handler@{Get\+Native\+Buffer\+Handler}}
\index{Get\+Native\+Buffer\+Handler@{Get\+Native\+Buffer\+Handler}!hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}}
\subsubsection{\texorpdfstring{Get\+Native\+Buffer\+Handler()}{GetNativeBufferHandler()}}
{\footnotesize\ttfamily const \mbox{\hyperlink{classhwcomposer_1_1NativeBufferHandler}{Native\+Buffer\+Handler}}$\ast$ hwcomposer\+::\+Resource\+Manager\+::\+Get\+Native\+Buffer\+Handler (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line 82 of file resourcemanager.\+h.


\begin{DoxyCode}{0}
\DoxyCodeLine{82                                                             \{}
\DoxyCodeLine{83     \textcolor{keywordflow}{return} buffer\_handler\_;}
\DoxyCodeLine{84   \}}
\end{DoxyCode}
\mbox{\Hypertarget{classhwcomposer_1_1ResourceManager_afda313d41d4a7d91f2c8e7fe99779f11}\label{classhwcomposer_1_1ResourceManager_afda313d41d4a7d91f2c8e7fe99779f11}} 
\index{hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}!Get\+Purged\+Resources@{Get\+Purged\+Resources}}
\index{Get\+Purged\+Resources@{Get\+Purged\+Resources}!hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}}
\subsubsection{\texorpdfstring{Get\+Purged\+Resources()}{GetPurgedResources()}}
{\footnotesize\ttfamily void hwcomposer\+::\+Resource\+Manager\+::\+Get\+Purged\+Resources (\begin{DoxyParamCaption}\item[{std\+::vector$<$ \mbox{\hyperlink{namespacehwcomposer_a963c5a1d5902d2d05710dba19af35b48}{Resource\+Handle}} $>$ \&}]{gl\+\_\+resources,  }\item[{std\+::vector$<$ \mbox{\hyperlink{namespacehwcomposer_aa99e35835961ac7d6baa59a04131ff42}{Media\+Resource\+Handle}} $>$ \&}]{media\+\_\+resources,  }\item[{bool $\ast$}]{has\+\_\+gpu\+\_\+resource }\end{DoxyParamCaption})}



Definition at line 107 of file resourcemanager.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{109                                                                              \{}
\DoxyCodeLine{110   lock\_.\mbox{\hyperlink{classhwcomposer_1_1SpinLock_a863f9d0f1b270f863a9298161b52faf1}{lock}}();}
\DoxyCodeLine{111   \textcolor{keywordtype}{size\_t} purged\_size = destroy\_gl\_resources\_.size();}
\DoxyCodeLine{112   *has\_gpu\_resource = destroy\_gpu\_resources\_;}
\DoxyCodeLine{113 }
\DoxyCodeLine{114   \textcolor{keywordflow}{if} (purged\_size != 0) \{}
\DoxyCodeLine{115     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < purged\_size; i++) \{}
\DoxyCodeLine{116       \textcolor{keyword}{const} \mbox{\hyperlink{namespacehwcomposer_a963c5a1d5902d2d05710dba19af35b48}{ResourceHandle}}\& handle = destroy\_gl\_resources\_.at(i);}
\DoxyCodeLine{117       gl\_resources.emplace\_back();}
\DoxyCodeLine{118       \mbox{\hyperlink{namespacehwcomposer_a963c5a1d5902d2d05710dba19af35b48}{ResourceHandle}}\& temp = gl\_resources.back();}
\DoxyCodeLine{119       std::memcpy(\&temp, \&handle, \textcolor{keyword}{sizeof} temp);}
\DoxyCodeLine{120     \}}
\DoxyCodeLine{121 }
\DoxyCodeLine{122     std::vector<ResourceHandle>().swap(destroy\_gl\_resources\_);}
\DoxyCodeLine{123     destroy\_gpu\_resources\_ = \textcolor{keyword}{false};}
\DoxyCodeLine{124   \}}
\DoxyCodeLine{125 }
\DoxyCodeLine{126   purged\_size = destroy\_media\_resources\_.size();}
\DoxyCodeLine{127   \textcolor{keywordflow}{if} (purged\_size != 0) \{}
\DoxyCodeLine{128     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < purged\_size; i++) \{}
\DoxyCodeLine{129       \textcolor{keyword}{const} \mbox{\hyperlink{namespacehwcomposer_aa99e35835961ac7d6baa59a04131ff42}{MediaResourceHandle}}\& handle = destroy\_media\_resources\_.at(i);}
\DoxyCodeLine{130       media\_resources.emplace\_back();}
\DoxyCodeLine{131       \mbox{\hyperlink{namespacehwcomposer_aa99e35835961ac7d6baa59a04131ff42}{MediaResourceHandle}}\& temp = media\_resources.back();}
\DoxyCodeLine{132       std::memcpy(\&temp, \&handle, \textcolor{keyword}{sizeof} temp);}
\DoxyCodeLine{133     \}}
\DoxyCodeLine{134 }
\DoxyCodeLine{135     std::vector<MediaResourceHandle>().swap(destroy\_media\_resources\_);}
\DoxyCodeLine{136   \}}
\DoxyCodeLine{137 }
\DoxyCodeLine{138   lock\_.\mbox{\hyperlink{classhwcomposer_1_1SpinLock_ae5cf624b4f0ec710833ce44e945b85d7}{unlock}}();}
\DoxyCodeLine{139 \}}
\end{DoxyCode}
\mbox{\Hypertarget{classhwcomposer_1_1ResourceManager_a0813f1ac50652ca59c3f4b03291dd4b4}\label{classhwcomposer_1_1ResourceManager_a0813f1ac50652ca59c3f4b03291dd4b4}} 
\index{hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}!Mark\+Media\+Resource\+For\+Deletion@{Mark\+Media\+Resource\+For\+Deletion}}
\index{Mark\+Media\+Resource\+For\+Deletion@{Mark\+Media\+Resource\+For\+Deletion}!hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}}
\subsubsection{\texorpdfstring{Mark\+Media\+Resource\+For\+Deletion()}{MarkMediaResourceForDeletion()}}
{\footnotesize\ttfamily void hwcomposer\+::\+Resource\+Manager\+::\+Mark\+Media\+Resource\+For\+Deletion (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacehwcomposer_aa99e35835961ac7d6baa59a04131ff42}{Media\+Resource\+Handle}} \&}]{handle }\end{DoxyParamCaption})}



Definition at line 100 of file resourcemanager.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{101                                        \{}
\DoxyCodeLine{102   purged\_media\_resources\_.emplace\_back();}
\DoxyCodeLine{103   \mbox{\hyperlink{namespacehwcomposer_aa99e35835961ac7d6baa59a04131ff42}{MediaResourceHandle}}\& temp = purged\_media\_resources\_.back();}
\DoxyCodeLine{104   std::memcpy(\&temp, \&handle, \textcolor{keyword}{sizeof} temp);}
\DoxyCodeLine{105 \}}
\end{DoxyCode}
\mbox{\Hypertarget{classhwcomposer_1_1ResourceManager_aed72efa73f3037049b1328ea35f162b3}\label{classhwcomposer_1_1ResourceManager_aed72efa73f3037049b1328ea35f162b3}} 
\index{hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}!Mark\+Resource\+For\+Deletion@{Mark\+Resource\+For\+Deletion}}
\index{Mark\+Resource\+For\+Deletion@{Mark\+Resource\+For\+Deletion}!hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}}
\subsubsection{\texorpdfstring{Mark\+Resource\+For\+Deletion()}{MarkResourceForDeletion()}}
{\footnotesize\ttfamily void hwcomposer\+::\+Resource\+Manager\+::\+Mark\+Resource\+For\+Deletion (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespacehwcomposer_a963c5a1d5902d2d05710dba19af35b48}{Resource\+Handle}} \&}]{handle,  }\item[{bool}]{has\+\_\+valid\+\_\+gpu\+\_\+resources }\end{DoxyParamCaption})}



Definition at line 91 of file resourcemanager.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{92                                                                             \{}
\DoxyCodeLine{93   purged\_resources\_.emplace\_back();}
\DoxyCodeLine{94   \mbox{\hyperlink{namespacehwcomposer_a963c5a1d5902d2d05710dba19af35b48}{ResourceHandle}}\& temp = purged\_resources\_.back();}
\DoxyCodeLine{95   std::memcpy(\&temp, \&handle, \textcolor{keyword}{sizeof} temp);}
\DoxyCodeLine{96   \textcolor{keywordflow}{if} (!has\_purged\_gpu\_resources\_)}
\DoxyCodeLine{97     has\_purged\_gpu\_resources\_ = has\_valid\_gpu\_resources;}
\DoxyCodeLine{98 \}}
\end{DoxyCode}
\mbox{\Hypertarget{classhwcomposer_1_1ResourceManager_a7ffb53b713befaf75975e667d21f1612}\label{classhwcomposer_1_1ResourceManager_a7ffb53b713befaf75975e667d21f1612}} 
\index{hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}!Prepare\+Purged\+Resources@{Prepare\+Purged\+Resources}}
\index{Prepare\+Purged\+Resources@{Prepare\+Purged\+Resources}!hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}}
\subsubsection{\texorpdfstring{Prepare\+Purged\+Resources()}{PreparePurgedResources()}}
{\footnotesize\ttfamily bool hwcomposer\+::\+Resource\+Manager\+::\+Prepare\+Purged\+Resources (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 146 of file resourcemanager.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{146                                              \{}
\DoxyCodeLine{147   \textcolor{keywordflow}{if} (cached\_buffers\_.size() > 4)}
\DoxyCodeLine{148     cached\_buffers\_.pop\_back();}
\DoxyCodeLine{149 }
\DoxyCodeLine{150   \textcolor{keywordflow}{if} (purged\_resources\_.empty() \&\& purged\_media\_resources\_.empty())}
\DoxyCodeLine{151     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{152 }
\DoxyCodeLine{153   lock\_.\mbox{\hyperlink{classhwcomposer_1_1SpinLock_a863f9d0f1b270f863a9298161b52faf1}{lock}}();}
\DoxyCodeLine{154   \textcolor{keywordflow}{if} (!purged\_resources\_.empty()) \{}
\DoxyCodeLine{155     \textcolor{keywordtype}{size\_t} purged\_size = purged\_resources\_.size();}
\DoxyCodeLine{156     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < purged\_size; i++) \{}
\DoxyCodeLine{157       \textcolor{keyword}{const} \mbox{\hyperlink{namespacehwcomposer_a963c5a1d5902d2d05710dba19af35b48}{ResourceHandle}}\& handle = purged\_resources\_.at(i);}
\DoxyCodeLine{158       destroy\_gl\_resources\_.emplace\_back();}
\DoxyCodeLine{159       \mbox{\hyperlink{namespacehwcomposer_a963c5a1d5902d2d05710dba19af35b48}{ResourceHandle}}\& temp = destroy\_gl\_resources\_.back();}
\DoxyCodeLine{160       std::memcpy(\&temp, \&handle, \textcolor{keyword}{sizeof} temp);}
\DoxyCodeLine{161     \}}
\DoxyCodeLine{162     std::vector<ResourceHandle>().swap(purged\_resources\_);}
\DoxyCodeLine{163   \}}
\DoxyCodeLine{164 }
\DoxyCodeLine{165   \textcolor{keywordflow}{if} (!purged\_media\_resources\_.empty()) \{}
\DoxyCodeLine{166     \textcolor{keywordtype}{size\_t} purged\_size = purged\_media\_resources\_.size();}
\DoxyCodeLine{167     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < purged\_size; i++) \{}
\DoxyCodeLine{168       \textcolor{keyword}{const} \mbox{\hyperlink{namespacehwcomposer_aa99e35835961ac7d6baa59a04131ff42}{MediaResourceHandle}}\& handle = purged\_media\_resources\_.at(i);}
\DoxyCodeLine{169       destroy\_media\_resources\_.emplace\_back();}
\DoxyCodeLine{170       \mbox{\hyperlink{namespacehwcomposer_aa99e35835961ac7d6baa59a04131ff42}{MediaResourceHandle}}\& temp = destroy\_media\_resources\_.back();}
\DoxyCodeLine{171       std::memcpy(\&temp, \&handle, \textcolor{keyword}{sizeof} temp);}
\DoxyCodeLine{172     \}}
\DoxyCodeLine{173     std::vector<MediaResourceHandle>().swap(purged\_media\_resources\_);}
\DoxyCodeLine{174   \}}
\DoxyCodeLine{175 }
\DoxyCodeLine{176   destroy\_gpu\_resources\_ = has\_purged\_gpu\_resources\_;}
\DoxyCodeLine{177   has\_purged\_gpu\_resources\_ = \textcolor{keyword}{false};}
\DoxyCodeLine{178   lock\_.\mbox{\hyperlink{classhwcomposer_1_1SpinLock_ae5cf624b4f0ec710833ce44e945b85d7}{unlock}}();}
\DoxyCodeLine{179 }
\DoxyCodeLine{180   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{181 \}}
\end{DoxyCode}
\mbox{\Hypertarget{classhwcomposer_1_1ResourceManager_ab30302bab7dc3e8609a431299e16a8f4}\label{classhwcomposer_1_1ResourceManager_ab30302bab7dc3e8609a431299e16a8f4}} 
\index{hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}!Purge\+Buffer@{Purge\+Buffer}}
\index{Purge\+Buffer@{Purge\+Buffer}!hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}}
\subsubsection{\texorpdfstring{Purge\+Buffer()}{PurgeBuffer()}}
{\footnotesize\ttfamily void hwcomposer\+::\+Resource\+Manager\+::\+Purge\+Buffer (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 41 of file resourcemanager.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{41                                   \{}
\DoxyCodeLine{42   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\& map : cached\_buffers\_) \{}
\DoxyCodeLine{43     map.clear();}
\DoxyCodeLine{44   \}}
\DoxyCodeLine{45 }
\DoxyCodeLine{46   \mbox{\hyperlink{classhwcomposer_1_1ResourceManager_a7ffb53b713befaf75975e667d21f1612}{PreparePurgedResources}}();}
\DoxyCodeLine{47 \}}
\end{DoxyCode}
\mbox{\Hypertarget{classhwcomposer_1_1ResourceManager_a303f37d04b5a8aa1aa91f579ed897b33}\label{classhwcomposer_1_1ResourceManager_a303f37d04b5a8aa1aa91f579ed897b33}} 
\index{hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}!Refresh\+Buffer\+Cache@{Refresh\+Buffer\+Cache}}
\index{Refresh\+Buffer\+Cache@{Refresh\+Buffer\+Cache}!hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}}
\subsubsection{\texorpdfstring{Refresh\+Buffer\+Cache()}{RefreshBufferCache()}}
{\footnotesize\ttfamily void hwcomposer\+::\+Resource\+Manager\+::\+Refresh\+Buffer\+Cache (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 141 of file resourcemanager.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{141                                          \{}
\DoxyCodeLine{142   \textcolor{keyword}{auto} begin = cached\_buffers\_.begin();}
\DoxyCodeLine{143   cached\_buffers\_.emplace(begin);}
\DoxyCodeLine{144 \}}
\end{DoxyCode}
\mbox{\Hypertarget{classhwcomposer_1_1ResourceManager_a7e086990e56fcf24ab2fbc47d677dcce}\label{classhwcomposer_1_1ResourceManager_a7e086990e56fcf24ab2fbc47d677dcce}} 
\index{hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}!Register\+Buffer@{Register\+Buffer}}
\index{Register\+Buffer@{Register\+Buffer}!hwcomposer\+::\+Resource\+Manager@{hwcomposer\+::\+Resource\+Manager}}
\subsubsection{\texorpdfstring{Register\+Buffer()}{RegisterBuffer()}}
{\footnotesize\ttfamily void hwcomposer\+::\+Resource\+Manager\+::\+Register\+Buffer (\begin{DoxyParamCaption}\item[{const uint32\+\_\+t \&}]{native\+\_\+buffer,  }\item[{std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classhwcomposer_1_1OverlayBuffer}{Overlay\+Buffer}} $>$ \&}]{p\+Buffer }\end{DoxyParamCaption})}



Definition at line 85 of file resourcemanager.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{86                                                                             \{}
\DoxyCodeLine{87   BUFFER\_MAP\& first\_map = cached\_buffers\_[0];}
\DoxyCodeLine{88   first\_map.emplace(std::make\_pair(native\_buffer, pBuffer));}
\DoxyCodeLine{89 \}}
\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
common/core/\mbox{\hyperlink{resourcemanager_8h}{resourcemanager.\+h}}\item 
common/core/\mbox{\hyperlink{resourcemanager_8cpp}{resourcemanager.\+cpp}}\end{DoxyCompactItemize}
