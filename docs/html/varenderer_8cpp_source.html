<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IA-Hardware-Composer: common/compositor/va/varenderer.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">IA-Hardware-Composer
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bdd9a5d540de89e9fe90efdfc6973a4f.html">common</a></li><li class="navelem"><a class="el" href="dir_62502b8e9eb828789e7b2bd193c0f945.html">compositor</a></li><li class="navelem"><a class="el" href="dir_069c743d27e9c98b80bad3ee8d87784d.html">va</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">varenderer.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="varenderer_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// Copyright (c) 2017 Intel Corporation</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// you may not use this file except in compliance with the License.</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// You may obtain a copy of the License at</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//      http://www.apache.org/licenses/LICENSE-2.0</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// Unless required by applicable law or agreed to in writing, software</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// See the License for the specific language governing permissions and</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">// limitations under the License.</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="varenderer_8h.html">varenderer.h</a>&quot;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;platformdefines.h&quot;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;xf86drm.h&gt;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &lt;drm_fourcc.h&gt;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;math.h&gt;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="hwctrace_8h.html">hwctrace.h</a>&quot;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="nativesurface_8h.html">nativesurface.h</a>&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="overlaybuffer_8h.html">overlaybuffer.h</a>&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="renderstate_8h.html">renderstate.h</a>&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacehwcomposer.html">hwcomposer</a> {</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="classhwcomposer_1_1VARenderer.html#affd21547dc812a4a39b1b5dbba33c9af">   31</a></span>&#160;<a class="code" href="classhwcomposer_1_1VARenderer.html#affd21547dc812a4a39b1b5dbba33c9af">VARenderer::~VARenderer</a>() {</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  DestroyContext();</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordflow">if</span> (va_display_) {</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    vaTerminate(va_display_);</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  }</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;}</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="classhwcomposer_1_1VARenderer.html#a93d5e911647cee44c892222c822df619">   39</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classhwcomposer_1_1Renderer.html#aa7f5e7d36857fb67093b9f0cc3a7e606">VARenderer::Init</a>(<span class="keywordtype">int</span> gpu_fd) {</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  va_display_ = <a class="code" href="alios_2platformdefines_8cpp.html#a776db37da150468eb39fc6fad0d7c9c1">GetVADisplay</a>(gpu_fd);</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keywordflow">if</span> (!va_display_) {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <a class="code" href="alios_2platformdefines_8h.html#a226d6c99e4bcfca193c095e085e9097d">ETRACE</a>(<span class="stringliteral">&quot;vaGetDisplay failed\n&quot;</span>);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  }</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  VAStatus ret = VA_STATUS_SUCCESS;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="keywordtype">int</span> major, minor;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  ret = vaInitialize(va_display_, &amp;major, &amp;minor);</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keywordflow">return</span> ret == VA_STATUS_SUCCESS ? true : <span class="keyword">false</span>;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;}</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="keywordtype">bool</span> VARenderer::QueryVAProcFilterCaps(VAContextID context,</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                                       VAProcFilterType type, <span class="keywordtype">void</span>* caps,</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                                       uint32_t* num) {</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  VAStatus ret =</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      vaQueryVideoProcFilterCaps(va_display_, context, type, caps, num);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="keywordflow">if</span> (ret != VA_STATUS_SUCCESS)</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <a class="code" href="alios_2platformdefines_8h.html#a226d6c99e4bcfca193c095e085e9097d">ETRACE</a>(<span class="stringliteral">&quot;Query Filter Caps failed\n&quot;</span>);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="keywordflow">return</span> ret == VA_STATUS_SUCCESS ? true : <span class="keyword">false</span>;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;}</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="keywordtype">bool</span> VARenderer::MapVAProcFilterColorModetoHwc(HWCColorControl&amp; vppmode,</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                                               VAProcColorBalanceType vamode) {</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="keywordflow">switch</span> (vamode) {</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordflow">case</span> VAProcColorBalanceHue:</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      vppmode = HWCColorControl::kColorHue;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordflow">case</span> VAProcColorBalanceSaturation:</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      vppmode = HWCColorControl::kColorSaturation;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordflow">case</span> VAProcColorBalanceBrightness:</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      vppmode = HWCColorControl::kColorBrightness;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordflow">case</span> VAProcColorBalanceContrast:</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      vppmode = HWCColorControl::kColorContrast;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  }</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;}</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="keywordtype">bool</span> VARenderer::SetVAProcFilterColorDefaultValue(</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    VAProcFilterCapColorBalance* caps) {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  HWCColorControl mode;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; VAProcColorBalanceCount; i++) {</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">if</span> (MapVAProcFilterColorModetoHwc(mode, caps[i].type)) {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      colorbalance_caps_[mode].caps_ = caps[i];</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      colorbalance_caps_[mode].value_ = caps[i].range.default_value;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    }</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  }</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  sharp_caps_.<a class="code" href="structhwcomposer_1_1HwcFilterCap.html#add5d14e96796b2c0230f11a99fa1254f">value_</a> = sharp_caps_.<a class="code" href="structhwcomposer_1_1HwcFilterCap.html#a142f15f008008849faa7f8102e7ed7c3">caps_</a>.range.default_value;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  update_caps_ = <span class="keyword">true</span>;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;}</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="keywordtype">bool</span> VARenderer::SetVAProcFilterDeinterlaceDefaultMode() {</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keywordflow">if</span> (deinterlace_caps_.<a class="code" href="structhwcomposer_1_1__HwcDeinterlaceCap.html#a188e0d349ff3c40e27be247592dfbcbc">mode_</a> != VAProcDeinterlacingNone) {</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    deinterlace_caps_.<a class="code" href="structhwcomposer_1_1__HwcDeinterlaceCap.html#a188e0d349ff3c40e27be247592dfbcbc">mode_</a> = VAProcDeinterlacingNone;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    update_caps_ = <span class="keyword">true</span>;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  }</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;}</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="keywordtype">bool</span> VARenderer::SetVAProcFilterColorValue(HWCColorControl mode,</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                                           <span class="keyword">const</span> HWCColorProp&amp; prop) {</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="keywordflow">if</span> (mode == HWCColorControl::kColorHue ||</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      mode == HWCColorControl::kColorSaturation ||</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      mode == HWCColorControl::kColorBrightness ||</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      mode == HWCColorControl::kColorContrast) {</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordflow">if</span> (prop.use_default_) {</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      <span class="keywordflow">if</span> (!colorbalance_caps_[mode].use_default_) {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        colorbalance_caps_[mode].use_default_ = <span class="keyword">true</span>;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        update_caps_ = <span class="keyword">true</span>;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      }</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (prop.value_ != colorbalance_caps_[mode].value_) {</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      <span class="keywordflow">if</span> (prop.value_ &gt; colorbalance_caps_[mode].caps_.range.max_value ||</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;          prop.value_ &lt; colorbalance_caps_[mode].caps_.range.min_value) {</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <a class="code" href="alios_2platformdefines_8h.html#a226d6c99e4bcfca193c095e085e9097d">ETRACE</a>(<span class="stringliteral">&quot;VA Filter value out of range. Mode %d range shoud be %f~%f\n&quot;</span>,</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;               mode, colorbalance_caps_[mode].caps_.range.min_value,</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;               colorbalance_caps_[mode].caps_.range.max_value);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;      }</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      colorbalance_caps_[mode].value_ = prop.value_;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      colorbalance_caps_[mode].use_default_ = <span class="keyword">false</span>;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      update_caps_ = <span class="keyword">true</span>;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode == HWCColorControl::kColorSharpness) {</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordflow">if</span> (prop.use_default_) {</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      <span class="keywordflow">if</span> (!sharp_caps_.<a class="code" href="structhwcomposer_1_1HwcFilterCap.html#ab934d5bbd9e4f61bdafccd6d620f3e09">use_default_</a>) {</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        sharp_caps_.<a class="code" href="structhwcomposer_1_1HwcFilterCap.html#ab934d5bbd9e4f61bdafccd6d620f3e09">use_default_</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        update_caps_ = <span class="keyword">true</span>;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      }</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (prop.value_ != sharp_caps_.<a class="code" href="structhwcomposer_1_1HwcFilterCap.html#add5d14e96796b2c0230f11a99fa1254f">value_</a>) {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="keywordflow">if</span> (prop.value_ &gt; sharp_caps_.<a class="code" href="structhwcomposer_1_1HwcFilterCap.html#a142f15f008008849faa7f8102e7ed7c3">caps_</a>.range.max_value ||</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;          prop.value_ &lt; sharp_caps_.<a class="code" href="structhwcomposer_1_1HwcFilterCap.html#a142f15f008008849faa7f8102e7ed7c3">caps_</a>.range.min_value) {</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <a class="code" href="alios_2platformdefines_8h.html#a226d6c99e4bcfca193c095e085e9097d">ETRACE</a>(<span class="stringliteral">&quot;VA Filter sharp value out of range. should be %f~%f\n&quot;</span>,</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;               sharp_caps_.<a class="code" href="structhwcomposer_1_1HwcFilterCap.html#a142f15f008008849faa7f8102e7ed7c3">caps_</a>.range.min_value,</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;               sharp_caps_.<a class="code" href="structhwcomposer_1_1HwcFilterCap.html#a142f15f008008849faa7f8102e7ed7c3">caps_</a>.range.max_value);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      }</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      sharp_caps_.<a class="code" href="structhwcomposer_1_1HwcFilterCap.html#add5d14e96796b2c0230f11a99fa1254f">value_</a> = prop.value_;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      sharp_caps_.<a class="code" href="structhwcomposer_1_1HwcFilterCap.html#ab934d5bbd9e4f61bdafccd6d620f3e09">use_default_</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      update_caps_ = <span class="keyword">true</span>;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    }</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <a class="code" href="alios_2platformdefines_8h.html#a226d6c99e4bcfca193c095e085e9097d">ETRACE</a>(<span class="stringliteral">&quot;VA Filter undefined color mode\n&quot;</span>);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  }</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;}</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="keywordtype">bool</span> VARenderer::GetVAProcDeinterlaceFlagFromVideo(HWCDeinterlaceFlag flag) {</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keywordflow">if</span> (flag != HWCDeinterlaceFlag::kDeinterlaceFlagAuto) {</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">// TODO:Need video buffer meta data to judge if the frame really need</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">// Deinterlace.</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;}</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="keywordtype">bool</span> VARenderer::SetVAProcFilterDeinterlaceMode(</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keyword">const</span> HWCDeinterlaceProp&amp; prop) {</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  VAProcDeinterlacingType mode;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="keywordflow">if</span> (prop.flag_ == HWCDeinterlaceFlag::kDeinterlaceFlagNone) {</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    SetVAProcFilterDeinterlaceDefaultMode();</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (prop.flag_ == HWCDeinterlaceFlag::kDeinterlaceFlagForce ||</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;             GetVAProcDeinterlaceFlagFromVideo(prop.flag_)) {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">switch</span> (prop.mode_) {</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      <span class="keywordflow">case</span> HWCDeinterlaceControl::kDeinterlaceNone:</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        mode = VAProcDeinterlacingNone;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <span class="keywordflow">case</span> HWCDeinterlaceControl::kDeinterlaceBob:</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        mode = VAProcDeinterlacingBob;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      <span class="keywordflow">case</span> HWCDeinterlaceControl::kDeinterlaceWeave:</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        mode = VAProcDeinterlacingWeave;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      <span class="keywordflow">case</span> HWCDeinterlaceControl::kDeinterlaceMotionAdaptive:</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        mode = VAProcDeinterlacingMotionAdaptive;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      <span class="keywordflow">case</span> HWCDeinterlaceControl::kDeinterlaceMotionCompensated:</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        mode = VAProcDeinterlacingMotionCompensated;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <a class="code" href="alios_2platformdefines_8h.html#a226d6c99e4bcfca193c095e085e9097d">ETRACE</a>(<span class="stringliteral">&quot;Hwc unsupport deinterlace mode\n&quot;</span>);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    }</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; VAProcDeinterlacingCount; i++) {</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <span class="keywordflow">if</span> (deinterlace_caps_.<a class="code" href="structhwcomposer_1_1__HwcDeinterlaceCap.html#ad5822e137156ac4bd12edd5a7da72e8f">caps_</a>[i].type == mode) {</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="keywordflow">if</span> (deinterlace_caps_.<a class="code" href="structhwcomposer_1_1__HwcDeinterlaceCap.html#a188e0d349ff3c40e27be247592dfbcbc">mode_</a> != mode) {</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;          update_caps_ = <span class="keyword">true</span>;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        }</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        deinterlace_caps_.<a class="code" href="structhwcomposer_1_1__HwcDeinterlaceCap.html#a188e0d349ff3c40e27be247592dfbcbc">mode_</a> = mode;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    }</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <a class="code" href="alios_2platformdefines_8h.html#a226d6c99e4bcfca193c095e085e9097d">ETRACE</a>(<span class="stringliteral">&quot;VA Filter unsupport deinterlace mode\n&quot;</span>);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  }</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;}</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> VARenderer::GetVAProcFilterScalingMode(uint32_t mode) {</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="keywordflow">switch</span> (mode) {</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">case</span> 1:</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <span class="keywordflow">return</span> VA_FILTER_SCALING_FAST;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">case</span> 2:</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      <span class="keywordflow">return</span> VA_FILTER_SCALING_HQ;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <span class="keywordflow">return</span> VA_FILTER_SCALING_HQ;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  }</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;}</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno"><a class="line" href="classhwcomposer_1_1VARenderer.html#a5fdcb230093416433e8cf394137b9cc1">  216</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classhwcomposer_1_1VARenderer.html#a5fdcb230093416433e8cf394137b9cc1">VARenderer::Draw</a>(<span class="keyword">const</span> <a class="code" href="structhwcomposer_1_1MediaState.html">MediaState</a>&amp; state, <a class="code" href="classhwcomposer_1_1NativeSurface.html">NativeSurface</a>* surface) {</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <a class="code" href="hwctrace_8h.html#a539a95897071c72babce1012d503b3ca">CTRACE</a>();</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="comment">// TODO: Clear surface ?</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  surface-&gt;<a class="code" href="classhwcomposer_1_1NativeSurface.html#ad2dd3e317071362a6dfefe3df74d91b0">SetClearSurface</a>(<a class="code" href="classhwcomposer_1_1NativeSurface.html#a0d0f955fc1e9f95c9684e9524f4217d6a61ab9864bcc7860917f12c33382befbc">NativeSurface::kNone</a>);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <a class="code" href="classhwcomposer_1_1OverlayBuffer.html">OverlayBuffer</a>* buffer_out = surface-&gt;<a class="code" href="classhwcomposer_1_1NativeSurface.html#ad14ba0261093321209ef08a170417d06">GetLayer</a>()-&gt;<a class="code" href="structhwcomposer_1_1OverlayLayer.html#a92e6edaec1053b6a2c015fe3f7c400c0">GetBuffer</a>();</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="keywordtype">int</span> rt_format = <a class="code" href="namespacehwcomposer.html#a487f8d9f8fe8490d7057be9a1c67b42e">DrmFormatToRTFormat</a>(buffer_out-&gt;<a class="code" href="classhwcomposer_1_1OverlayBuffer.html#af12a31161149b0f89e92e5dfc18732c5">GetFormat</a>());</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="keywordflow">if</span> (va_context_ == VA_INVALID_ID || render_target_format_ != rt_format) {</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    render_target_format_ = rt_format;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keywordflow">if</span> (!CreateContext()) {</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      <a class="code" href="alios_2platformdefines_8h.html#a226d6c99e4bcfca193c095e085e9097d">ETRACE</a>(<span class="stringliteral">&quot;Create VA context failed\n&quot;</span>);</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    }</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  }</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="comment">// Get Input Surface.</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <a class="code" href="classhwcomposer_1_1OverlayBuffer.html">OverlayBuffer</a>* buffer_in = state.<a class="code" href="structhwcomposer_1_1MediaState.html#a43e040e443a44a8c5ac653f49be17dca">layer_</a>-&gt;<a class="code" href="structhwcomposer_1_1OverlayLayer.html#a92e6edaec1053b6a2c015fe3f7c400c0">GetBuffer</a>();</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="keyword">const</span> <a class="code" href="structhwcomposer_1_1media__import.html">MediaResourceHandle</a>&amp; resource = buffer_in-&gt;<a class="code" href="classhwcomposer_1_1OverlayBuffer.html#a947d4a8ef39b9a1a254325e32d4a45c2">GetMediaResource</a>(</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      va_display_, state.<a class="code" href="structhwcomposer_1_1MediaState.html#a43e040e443a44a8c5ac653f49be17dca">layer_</a>-&gt;<a class="code" href="structhwcomposer_1_1OverlayLayer.html#aa2b5ebe5d682703e3a038f46de8aab3c">GetSourceCropWidth</a>(),</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      state.<a class="code" href="structhwcomposer_1_1MediaState.html#a43e040e443a44a8c5ac653f49be17dca">layer_</a>-&gt;<a class="code" href="structhwcomposer_1_1OverlayLayer.html#a8c9e307b0c311016242bff146959a7de">GetSourceCropHeight</a>());</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  VASurfaceID surface_in = resource.<a class="code" href="structhwcomposer_1_1media__import.html#af82420941f64a848639e0ac80a7b2861">surface_</a>;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="keywordflow">if</span> (surface_in == VA_INVALID_ID) {</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <a class="code" href="alios_2platformdefines_8h.html#a226d6c99e4bcfca193c095e085e9097d">ETRACE</a>(<span class="stringliteral">&quot;Failed to create Va Input Surface. \n&quot;</span>);</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  }</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="comment">// Get Output Surface.</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="keyword">const</span> <a class="code" href="structhwcomposer_1_1OverlayLayer.html">OverlayLayer</a>* layer_out = surface-&gt;<a class="code" href="classhwcomposer_1_1NativeSurface.html#ad14ba0261093321209ef08a170417d06">GetLayer</a>();</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="keyword">const</span> <a class="code" href="structhwcomposer_1_1media__import.html">MediaResourceHandle</a>&amp; out_resource =</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      layer_out-&gt;<a class="code" href="structhwcomposer_1_1OverlayLayer.html#a92e6edaec1053b6a2c015fe3f7c400c0">GetBuffer</a>()-&gt;<a class="code" href="classhwcomposer_1_1OverlayBuffer.html#a947d4a8ef39b9a1a254325e32d4a45c2">GetMediaResource</a>(</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;          va_display_, layer_out-&gt;<a class="code" href="structhwcomposer_1_1OverlayLayer.html#aa2b5ebe5d682703e3a038f46de8aab3c">GetSourceCropWidth</a>(),</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;          layer_out-&gt;<a class="code" href="structhwcomposer_1_1OverlayLayer.html#a8c9e307b0c311016242bff146959a7de">GetSourceCropHeight</a>());</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  VASurfaceID surface_out = out_resource.<a class="code" href="structhwcomposer_1_1media__import.html#af82420941f64a848639e0ac80a7b2861">surface_</a>;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <span class="keywordflow">if</span> (surface_out == VA_INVALID_ID) {</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <a class="code" href="alios_2platformdefines_8h.html#a226d6c99e4bcfca193c095e085e9097d">ETRACE</a>(<span class="stringliteral">&quot;Failed to create Va Output Surface. \n&quot;</span>);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  }</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  VARectangle surface_region;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="keyword">const</span> <a class="code" href="structhwcomposer_1_1OverlayLayer.html">OverlayLayer</a>* layer_in = state.<a class="code" href="structhwcomposer_1_1MediaState.html#a43e040e443a44a8c5ac653f49be17dca">layer_</a>;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="keyword">const</span> HwcRect&lt;float&gt;&amp; source_crop = layer_in-&gt;<a class="code" href="structhwcomposer_1_1OverlayLayer.html#a91d909615d951f362553303650e5d237">GetSourceCrop</a>();</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  surface_region.x = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(source_crop.left);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  surface_region.y = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(source_crop.top);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  surface_region.width = layer_in-&gt;<a class="code" href="structhwcomposer_1_1OverlayLayer.html#aa2b5ebe5d682703e3a038f46de8aab3c">GetSourceCropWidth</a>();</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  surface_region.height = layer_in-&gt;<a class="code" href="structhwcomposer_1_1OverlayLayer.html#a8c9e307b0c311016242bff146959a7de">GetSourceCropHeight</a>();</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  VARectangle output_region;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keyword">const</span> HwcRect&lt;float&gt;&amp; source_crop_out = layer_out-&gt;<a class="code" href="structhwcomposer_1_1OverlayLayer.html#a91d909615d951f362553303650e5d237">GetSourceCrop</a>();</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  output_region.x = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(source_crop_out.left);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  output_region.y = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(source_crop_out.top);</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  output_region.width = layer_out-&gt;<a class="code" href="structhwcomposer_1_1OverlayLayer.html#aa2b5ebe5d682703e3a038f46de8aab3c">GetSourceCropWidth</a>();</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  output_region.height = layer_out-&gt;<a class="code" href="structhwcomposer_1_1OverlayLayer.html#a8c9e307b0c311016242bff146959a7de">GetSourceCropHeight</a>();</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  VAProcPipelineParameterBuffer pipe_param = {};</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  pipe_param.surface = surface_in;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  pipe_param.surface_region = &amp;surface_region;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  pipe_param.surface_color_standard = VAProcColorStandardBT601;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  pipe_param.output_region = &amp;output_region;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  pipe_param.output_color_standard = VAProcColorStandardBT601;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <a class="code" href="hwctrace_8h.html#a8f0916f7778d78a386afc1e5d8be8a25">DUMPTRACE</a>(<span class="stringliteral">&quot;surface_region: (%d, %d, %d, %d)\n&quot;</span>, surface_region.x,</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            surface_region.y, surface_region.width, surface_region.height);</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <a class="code" href="hwctrace_8h.html#a8f0916f7778d78a386afc1e5d8be8a25">DUMPTRACE</a>(<span class="stringliteral">&quot;Layer DisplayFrame:(%d,%d,%d,%d)\n&quot;</span>, output_region.x,</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            output_region.y, output_region.width, output_region.height);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> itr = state.<a class="code" href="structhwcomposer_1_1MediaState.html#a63b705c25506563ee4b6fdde3f4b5817">colors_</a>.begin(); itr != state.<a class="code" href="structhwcomposer_1_1MediaState.html#a63b705c25506563ee4b6fdde3f4b5817">colors_</a>.end(); itr++) {</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    SetVAProcFilterColorValue(itr-&gt;first, itr-&gt;second);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  }</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  SetVAProcFilterDeinterlaceMode(state.<a class="code" href="structhwcomposer_1_1MediaState.html#a9326ae6dea06def21b8aba4bb4500002">deinterlace_</a>);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="keywordflow">if</span> (!UpdateCaps()) {</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <a class="code" href="alios_2platformdefines_8h.html#a226d6c99e4bcfca193c095e085e9097d">ETRACE</a>(<span class="stringliteral">&quot;Failed to update capabailities. \n&quot;</span>);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  }</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  pipe_param.filter_flags = GetVAProcFilterScalingMode(state.<a class="code" href="structhwcomposer_1_1MediaState.html#addeecd9addfdd71066eac26d6ef270c3">scaling_mode_</a>);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="keywordflow">if</span> (filters_.size()) {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    pipe_param.filters = filters_.data();</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  }</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  pipe_param.num_filters = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(filters_.size());</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="preprocessor">#if VA_MAJOR_VERSION &gt;= 1</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="comment">// currently rotation is only supported by VA on Android.</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  uint32_t rotation = 0, mirror = 0;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  HWCTransformToVA(state.<a class="code" href="structhwcomposer_1_1MediaState.html#a43e040e443a44a8c5ac653f49be17dca">layer_</a>-&gt;<a class="code" href="structhwcomposer_1_1OverlayLayer.html#a4561204c8e092b5e37d8222c431c296c">GetTransform</a>(), rotation, mirror);</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  pipe_param.rotation_state = rotation;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  pipe_param.mirror_state = mirror;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <a class="code" href="classhwcomposer_1_1ScopedVABufferID.html">ScopedVABufferID</a> pipeline_buffer(va_display_);</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="keywordflow">if</span> (!pipeline_buffer.<a class="code" href="classhwcomposer_1_1ScopedVABufferID.html#a180ba4428678cb4206539af1eed5193c">CreateBuffer</a>(</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;          va_context_, VAProcPipelineParameterBufferType,</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;          <span class="keyword">sizeof</span>(VAProcPipelineParameterBuffer), 1, &amp;pipe_param)) {</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  }</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  VAStatus ret = VA_STATUS_SUCCESS;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  ret = vaBeginPicture(va_display_, va_context_, surface_out);</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  ret |=</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      vaRenderPicture(va_display_, va_context_, &amp;pipeline_buffer.<a class="code" href="classhwcomposer_1_1ScopedVABufferID.html#addd0a1e123031e370d1ff6e42f579132">buffer</a>(), 1);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  ret |= vaEndPicture(va_display_, va_context_);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="keywordflow">if</span> (surface_region.width == 1920 &amp;&amp; surface_region.height == 1080) {</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="comment">// FIXME: WA for OAM-63127. Not sure why this is needed but seems</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="comment">// to ensure we have consistent 60 fps.</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    vaSyncSurface(va_display_, surface_out);</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  }</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  surface-&gt;<a class="code" href="classhwcomposer_1_1NativeSurface.html#a27af1f56db8a926c53c93d0e2035efe9">ResetDamage</a>();</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="keywordflow">return</span> ret == VA_STATUS_SUCCESS ? true : <span class="keyword">false</span>;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;}</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno"><a class="line" href="classhwcomposer_1_1VARenderer.html#a0db23648105f69ce00fea498f28f87ec">  328</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classhwcomposer_1_1VARenderer.html#a0db23648105f69ce00fea498f28f87ec">VARenderer::DestroyMediaResources</a>(</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    std::vector&lt;struct media_import&gt;&amp; resources) {</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="keywordtype">size_t</span> purged_size = resources.size();</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; purged_size; i++) {</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <a class="code" href="structhwcomposer_1_1media__import.html">MediaResourceHandle</a>&amp; handle = resources.at(i);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="keywordflow">if</span> (handle.<a class="code" href="structhwcomposer_1_1media__import.html#af82420941f64a848639e0ac80a7b2861">surface_</a> != VA_INVALID_ID) {</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      vaDestroySurfaces(va_display_, &amp;handle.<a class="code" href="structhwcomposer_1_1media__import.html#af82420941f64a848639e0ac80a7b2861">surface_</a>, 1);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    }</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  }</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;}</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="keywordtype">bool</span> VARenderer::LoadCaps() {</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  VAProcFilterCapColorBalance colorbalancecaps[VAProcColorBalanceCount];</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  uint32_t colorbalance_num = VAProcColorBalanceCount;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  uint32_t sharp_num = 1;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  uint32_t deinterlace_num = VAProcDeinterlacingCount;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  memset(colorbalancecaps, 0,</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;         <span class="keyword">sizeof</span>(VAProcFilterCapColorBalance) * VAProcColorBalanceCount);</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="keywordflow">if</span> (!QueryVAProcFilterCaps(va_context_, VAProcFilterColorBalance,</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                             colorbalancecaps, &amp;colorbalance_num)) {</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  }</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="keywordflow">if</span> (!QueryVAProcFilterCaps(va_context_, VAProcFilterSharpening,</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                             &amp;sharp_caps_.<a class="code" href="structhwcomposer_1_1HwcFilterCap.html#a142f15f008008849faa7f8102e7ed7c3">caps_</a>, &amp;sharp_num)) {</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  }</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="keywordflow">if</span> (!QueryVAProcFilterCaps(va_context_, VAProcFilterDeinterlacing,</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                             &amp;deinterlace_caps_.<a class="code" href="structhwcomposer_1_1__HwcDeinterlaceCap.html#ad5822e137156ac4bd12edd5a7da72e8f">caps_</a>, &amp;deinterlace_num)) {</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  }</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  SetVAProcFilterColorDefaultValue(&amp;colorbalancecaps[0]);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  SetVAProcFilterDeinterlaceDefaultMode();</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;}</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="keywordtype">bool</span> VARenderer::CreateContext() {</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  DestroyContext();</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  VAConfigAttrib config_attrib;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  config_attrib.type = VAConfigAttribRTFormat;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  config_attrib.value = render_target_format_;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  VAStatus ret =</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      vaCreateConfig(va_display_, VAProfileNone, VAEntrypointVideoProc,</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                     &amp;config_attrib, 1, &amp;va_config_);</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <span class="keywordflow">if</span> (ret != VA_STATUS_SUCCESS) {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <a class="code" href="alios_2platformdefines_8h.html#a226d6c99e4bcfca193c095e085e9097d">ETRACE</a>(<span class="stringliteral">&quot;Create VA Config failed\n&quot;</span>);</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  }</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="comment">// These parameters are not used in vaCreateContext so just set them to dummy</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="comment">// values</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="keywordtype">int</span> width = 1;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="keywordtype">int</span> height = 1;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  ret = vaCreateContext(va_display_, va_config_, width, height, 0x00, <span class="keyword">nullptr</span>,</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                        0, &amp;va_context_);</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  update_caps_ = <span class="keyword">true</span>;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keywordflow">if</span> (ret == VA_STATUS_SUCCESS) {</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordflow">if</span> (!LoadCaps() || !UpdateCaps())</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  }</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keywordflow">return</span> ret == VA_STATUS_SUCCESS ? true : <span class="keyword">false</span>;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;}</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="keywordtype">void</span> VARenderer::DestroyContext() {</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="keywordflow">if</span> (va_context_ != VA_INVALID_ID) {</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    vaDestroyContext(va_display_, va_context_);</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    va_context_ = VA_INVALID_ID;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  }</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="keywordflow">if</span> (va_config_ != VA_INVALID_ID) {</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    vaDestroyConfig(va_display_, va_config_);</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    va_config_ = VA_INVALID_ID;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  }</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  std::vector&lt;VABufferID&gt;().swap(filters_);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  std::vector&lt;ScopedVABufferID&gt;().swap(cb_elements_);</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  std::vector&lt;ScopedVABufferID&gt;().swap(sharp_);</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;}</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="keywordtype">bool</span> VARenderer::UpdateCaps() {</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="keywordflow">if</span> (!update_caps_) {</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  }</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  update_caps_ = <span class="keyword">false</span>;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  std::vector&lt;ScopedVABufferID&gt; cb_elements(1, va_display_);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  std::vector&lt;ScopedVABufferID&gt; sharp(1, va_display_);</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  std::vector&lt;ScopedVABufferID&gt; deinterlace(1, va_display_);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  std::vector&lt;VABufferID&gt;().swap(filters_);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  std::vector&lt;ScopedVABufferID&gt;().swap(cb_elements_);</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  std::vector&lt;ScopedVABufferID&gt;().swap(sharp_);</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  std::vector&lt;ScopedVABufferID&gt;().swap(deinterlace_);</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  VAProcFilterParameterBufferColorBalance cbparam[VAProcColorBalanceCount];</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  VAProcFilterParameterBuffer sharpparam;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  VAProcFilterParameterBufferDeinterlacing deinterlaceparam;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  memset(cbparam, 0, VAProcColorBalanceCount *</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                         <span class="keyword">sizeof</span>(VAProcFilterParameterBufferColorBalance));</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="keywordtype">int</span> index = 0;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> itr = colorbalance_caps_.begin(); itr != colorbalance_caps_.end();</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;       itr++) {</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keywordflow">if</span> (itr-&gt;second.use_default_) {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      itr-&gt;second.value_ = itr-&gt;second.caps_.range.default_value;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    }</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keywordflow">if</span> (fabs(itr-&gt;second.value_ - itr-&gt;second.caps_.range.default_value) &gt;=</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        itr-&gt;second.caps_.range.step) {</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      cbparam[index].type = VAProcFilterColorBalance;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      cbparam[index].value = itr-&gt;second.value_;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      cbparam[index].attrib = itr-&gt;second.caps_.type;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      index++;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    }</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  }</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <span class="keywordflow">if</span> (index) {</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keywordflow">if</span> (!cb_elements[0].CreateBuffer(</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            va_context_, VAProcFilterParameterBufferType,</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            <span class="keyword">sizeof</span>(VAProcFilterParameterBufferColorBalance), index, cbparam)) {</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      <a class="code" href="alios_2platformdefines_8h.html#a226d6c99e4bcfca193c095e085e9097d">ETRACE</a>(<span class="stringliteral">&quot;Create color fail\n&quot;</span>);</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    }</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    filters_.push_back(cb_elements[0].buffer());</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  }</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  cb_elements_.swap(cb_elements);</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="keywordflow">if</span> (sharp_caps_.<a class="code" href="structhwcomposer_1_1HwcFilterCap.html#ab934d5bbd9e4f61bdafccd6d620f3e09">use_default_</a>) {</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    sharp_caps_.<a class="code" href="structhwcomposer_1_1HwcFilterCap.html#add5d14e96796b2c0230f11a99fa1254f">value_</a> = sharp_caps_.<a class="code" href="structhwcomposer_1_1HwcFilterCap.html#a142f15f008008849faa7f8102e7ed7c3">caps_</a>.range.default_value;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  }</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="keywordflow">if</span> (fabs(sharp_caps_.<a class="code" href="structhwcomposer_1_1HwcFilterCap.html#add5d14e96796b2c0230f11a99fa1254f">value_</a> - sharp_caps_.<a class="code" href="structhwcomposer_1_1HwcFilterCap.html#a142f15f008008849faa7f8102e7ed7c3">caps_</a>.range.default_value) &gt;=</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      sharp_caps_.<a class="code" href="structhwcomposer_1_1HwcFilterCap.html#a142f15f008008849faa7f8102e7ed7c3">caps_</a>.range.step) {</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    sharpparam.value = sharp_caps_.<a class="code" href="structhwcomposer_1_1HwcFilterCap.html#add5d14e96796b2c0230f11a99fa1254f">value_</a>;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    sharpparam.type = VAProcFilterSharpening;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordflow">if</span> (!sharp[0].CreateBuffer(va_context_, VAProcFilterParameterBufferType,</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                               <span class="keyword">sizeof</span>(VAProcFilterParameterBuffer), 1,</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                               &amp;sharpparam)) {</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    }</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    filters_.push_back(sharp[0].buffer());</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  }</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  sharp_.swap(sharp);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <span class="keywordflow">if</span> (deinterlace_caps_.<a class="code" href="structhwcomposer_1_1__HwcDeinterlaceCap.html#a188e0d349ff3c40e27be247592dfbcbc">mode_</a> != VAProcDeinterlacingNone) {</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    deinterlaceparam.algorithm = deinterlace_caps_.<a class="code" href="structhwcomposer_1_1__HwcDeinterlaceCap.html#a188e0d349ff3c40e27be247592dfbcbc">mode_</a>;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    deinterlaceparam.type = VAProcFilterDeinterlacing;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">if</span> (!deinterlace[0].CreateBuffer(</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;            va_context_, VAProcFilterParameterBufferType,</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            <span class="keyword">sizeof</span>(VAProcFilterParameterBufferDeinterlacing), 1,</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;            &amp;deinterlaceparam)) {</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    }</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    filters_.push_back(deinterlace[0].buffer());</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  }</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  deinterlace_.swap(deinterlace);</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;}</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="preprocessor">#if VA_MAJOR_VERSION &gt;= 1</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="keywordtype">void</span> VARenderer::HWCTransformToVA(uint32_t transform, uint32_t&amp; rotation,</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                                  uint32_t&amp; mirror) {</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  rotation = VA_ROTATION_NONE;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  mirror = VA_MIRROR_NONE;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <span class="keywordflow">if</span> (transform &amp; kReflectX)</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    mirror |= VA_MIRROR_HORIZONTAL;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <span class="keywordflow">if</span> (transform &amp; kReflectY)</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    mirror |= VA_MIRROR_VERTICAL;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="keywordflow">if</span> (mirror == VA_MIRROR_NONE ||</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      mirror == (VA_MIRROR_HORIZONTAL | VA_MIRROR_VERTICAL)) {</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    transform &amp;= ~kReflectX;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    transform &amp;= ~kReflectY;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="keywordflow">switch</span> (transform) {</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      <span class="keywordflow">case</span> kTransform270:</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        rotation = VA_ROTATION_270;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      <span class="keywordflow">case</span> kTransform180:</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        rotation = VA_ROTATION_180;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      <span class="keywordflow">case</span> kTransform90:</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        rotation = VA_ROTATION_90;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    }</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="comment">// Fixme? WA added. VA is using rotation then mirror order</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="comment">// CTS Cameration orientation is expecting mirror, then rotation</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="comment">// WA added to use inverse rotation to make the same result</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="keywordflow">if</span> (transform &amp; kTransform180)</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      rotation = VA_ROTATION_180;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (transform &amp; kTransform90)</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      rotation = VA_ROTATION_270;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (transform &amp; kTransform270)</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      rotation = VA_ROTATION_90;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  }</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;}</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;}  <span class="comment">// namespace hwcomposer</span></div><div class="ttc" id="structhwcomposer_1_1HwcFilterCap_html_add5d14e96796b2c0230f11a99fa1254f"><div class="ttname"><a href="structhwcomposer_1_1HwcFilterCap.html#add5d14e96796b2c0230f11a99fa1254f">hwcomposer::HwcFilterCap::value_</a></div><div class="ttdeci">float value_</div><div class="ttdef"><b>Definition:</b> <a href="varenderer_8h_source.html#l00075">varenderer.h:75</a></div></div>
<div class="ttc" id="varenderer_8h_html"><div class="ttname"><a href="varenderer_8h.html">varenderer.h</a></div></div>
<div class="ttc" id="classhwcomposer_1_1ScopedVABufferID_html_a180ba4428678cb4206539af1eed5193c"><div class="ttname"><a href="classhwcomposer_1_1ScopedVABufferID.html#a180ba4428678cb4206539af1eed5193c">hwcomposer::ScopedVABufferID::CreateBuffer</a></div><div class="ttdeci">bool CreateBuffer(VAContextID context, VABufferType type, uint32_t size, uint32_t num, void *data)</div><div class="ttdef"><b>Definition:</b> <a href="varenderer_8h_source.html#l00043">varenderer.h:43</a></div></div>
<div class="ttc" id="structhwcomposer_1_1MediaState_html_a9326ae6dea06def21b8aba4bb4500002"><div class="ttname"><a href="structhwcomposer_1_1MediaState.html#a9326ae6dea06def21b8aba4bb4500002">hwcomposer::MediaState::deinterlace_</a></div><div class="ttdeci">HWCDeinterlaceProp deinterlace_</div><div class="ttdef"><b>Definition:</b> <a href="renderstate_8h_source.html#l00065">renderstate.h:65</a></div></div>
<div class="ttc" id="overlaybuffer_8h_html"><div class="ttname"><a href="overlaybuffer_8h.html">overlaybuffer.h</a></div></div>
<div class="ttc" id="nativesurface_8h_html"><div class="ttname"><a href="nativesurface_8h.html">nativesurface.h</a></div></div>
<div class="ttc" id="classhwcomposer_1_1VARenderer_html_a0db23648105f69ce00fea498f28f87ec"><div class="ttname"><a href="classhwcomposer_1_1VARenderer.html#a0db23648105f69ce00fea498f28f87ec">hwcomposer::VARenderer::DestroyMediaResources</a></div><div class="ttdeci">bool DestroyMediaResources(std::vector&lt; struct media_import &gt; &amp;) override</div><div class="ttdef"><b>Definition:</b> <a href="varenderer_8cpp_source.html#l00328">varenderer.cpp:328</a></div></div>
<div class="ttc" id="structhwcomposer_1_1MediaState_html_a63b705c25506563ee4b6fdde3f4b5817"><div class="ttname"><a href="structhwcomposer_1_1MediaState.html#a63b705c25506563ee4b6fdde3f4b5817">hwcomposer::MediaState::colors_</a></div><div class="ttdeci">HWCColorMap colors_</div><div class="ttdef"><b>Definition:</b> <a href="renderstate_8h_source.html#l00064">renderstate.h:64</a></div></div>
<div class="ttc" id="classhwcomposer_1_1NativeSurface_html_ad14ba0261093321209ef08a170417d06"><div class="ttname"><a href="classhwcomposer_1_1NativeSurface.html#ad14ba0261093321209ef08a170417d06">hwcomposer::NativeSurface::GetLayer</a></div><div class="ttdeci">OverlayLayer * GetLayer()</div><div class="ttdef"><b>Definition:</b> <a href="nativesurface_8h_source.html#l00065">nativesurface.h:65</a></div></div>
<div class="ttc" id="structhwcomposer_1_1OverlayLayer_html_a4561204c8e092b5e37d8222c431c296c"><div class="ttname"><a href="structhwcomposer_1_1OverlayLayer.html#a4561204c8e092b5e37d8222c431c296c">hwcomposer::OverlayLayer::GetTransform</a></div><div class="ttdeci">uint32_t GetTransform() const</div><div class="ttdef"><b>Definition:</b> <a href="overlaylayer_8h_source.html#l00085">overlaylayer.h:85</a></div></div>
<div class="ttc" id="classhwcomposer_1_1ScopedVABufferID_html_addd0a1e123031e370d1ff6e42f579132"><div class="ttname"><a href="classhwcomposer_1_1ScopedVABufferID.html#addd0a1e123031e370d1ff6e42f579132">hwcomposer::ScopedVABufferID::buffer</a></div><div class="ttdeci">VABufferID buffer() const</div><div class="ttdef"><b>Definition:</b> <a href="varenderer_8h_source.html#l00054">varenderer.h:54</a></div></div>
<div class="ttc" id="classhwcomposer_1_1NativeSurface_html"><div class="ttname"><a href="classhwcomposer_1_1NativeSurface.html">hwcomposer::NativeSurface</a></div><div class="ttdef"><b>Definition:</b> <a href="nativesurface_8h_source.html#l00031">nativesurface.h:31</a></div></div>
<div class="ttc" id="hwctrace_8h_html"><div class="ttname"><a href="hwctrace_8h.html">hwctrace.h</a></div></div>
<div class="ttc" id="renderstate_8h_html"><div class="ttname"><a href="renderstate_8h.html">renderstate.h</a></div></div>
<div class="ttc" id="classhwcomposer_1_1NativeSurface_html_a27af1f56db8a926c53c93d0e2035efe9"><div class="ttname"><a href="classhwcomposer_1_1NativeSurface.html#a27af1f56db8a926c53c93d0e2035efe9">hwcomposer::NativeSurface::ResetDamage</a></div><div class="ttdeci">void ResetDamage()</div><div class="ttdef"><b>Definition:</b> <a href="nativesurface_8cpp_source.html#l00207">nativesurface.cpp:207</a></div></div>
<div class="ttc" id="classhwcomposer_1_1NativeSurface_html_a0d0f955fc1e9f95c9684e9524f4217d6a61ab9864bcc7860917f12c33382befbc"><div class="ttname"><a href="classhwcomposer_1_1NativeSurface.html#a0d0f955fc1e9f95c9684e9524f4217d6a61ab9864bcc7860917f12c33382befbc">hwcomposer::NativeSurface::kNone</a></div><div class="ttdef"><b>Definition:</b> <a href="nativesurface_8h_source.html#l00034">nativesurface.h:34</a></div></div>
<div class="ttc" id="structhwcomposer_1_1HwcFilterCap_html_a142f15f008008849faa7f8102e7ed7c3"><div class="ttname"><a href="structhwcomposer_1_1HwcFilterCap.html#a142f15f008008849faa7f8102e7ed7c3">hwcomposer::HwcFilterCap::caps_</a></div><div class="ttdeci">VAProcFilterCap caps_</div><div class="ttdef"><b>Definition:</b> <a href="varenderer_8h_source.html#l00074">varenderer.h:74</a></div></div>
<div class="ttc" id="structhwcomposer_1_1OverlayLayer_html_a92e6edaec1053b6a2c015fe3f7c400c0"><div class="ttname"><a href="structhwcomposer_1_1OverlayLayer.html#a92e6edaec1053b6a2c015fe3f7c400c0">hwcomposer::OverlayLayer::GetBuffer</a></div><div class="ttdeci">OverlayBuffer * GetBuffer() const</div><div class="ttdef"><b>Definition:</b> <a href="overlaylayer_8cpp_source.html#l00064">overlaylayer.cpp:64</a></div></div>
<div class="ttc" id="structhwcomposer_1_1__HwcDeinterlaceCap_html_a188e0d349ff3c40e27be247592dfbcbc"><div class="ttname"><a href="structhwcomposer_1_1__HwcDeinterlaceCap.html#a188e0d349ff3c40e27be247592dfbcbc">hwcomposer::_HwcDeinterlaceCap::mode_</a></div><div class="ttdeci">VAProcDeinterlacingType mode_</div><div class="ttdef"><b>Definition:</b> <a href="varenderer_8h_source.html#l00081">varenderer.h:81</a></div></div>
<div class="ttc" id="structhwcomposer_1_1OverlayLayer_html_a91d909615d951f362553303650e5d237"><div class="ttname"><a href="structhwcomposer_1_1OverlayLayer.html#a91d909615d951f362553303650e5d237">hwcomposer::OverlayLayer::GetSourceCrop</a></div><div class="ttdeci">const HwcRect&lt; float &gt; &amp; GetSourceCrop() const</div><div class="ttdef"><b>Definition:</b> <a href="overlaylayer_8h_source.html#l00109">overlaylayer.h:109</a></div></div>
<div class="ttc" id="structhwcomposer_1_1OverlayLayer_html_aa2b5ebe5d682703e3a038f46de8aab3c"><div class="ttname"><a href="structhwcomposer_1_1OverlayLayer.html#aa2b5ebe5d682703e3a038f46de8aab3c">hwcomposer::OverlayLayer::GetSourceCropWidth</a></div><div class="ttdeci">uint32_t GetSourceCropWidth() const</div><div class="ttdef"><b>Definition:</b> <a href="overlaylayer_8h_source.html#l00126">overlaylayer.h:126</a></div></div>
<div class="ttc" id="structhwcomposer_1_1MediaState_html"><div class="ttname"><a href="structhwcomposer_1_1MediaState.html">hwcomposer::MediaState</a></div><div class="ttdef"><b>Definition:</b> <a href="renderstate_8h_source.html#l00062">renderstate.h:62</a></div></div>
<div class="ttc" id="classhwcomposer_1_1ScopedVABufferID_html"><div class="ttname"><a href="classhwcomposer_1_1ScopedVABufferID.html">hwcomposer::ScopedVABufferID</a></div><div class="ttdef"><b>Definition:</b> <a href="varenderer_8h_source.html#l00034">varenderer.h:34</a></div></div>
<div class="ttc" id="structhwcomposer_1_1OverlayLayer_html"><div class="ttname"><a href="structhwcomposer_1_1OverlayLayer.html">hwcomposer::OverlayLayer</a></div><div class="ttdef"><b>Definition:</b> <a href="overlaylayer_8h_source.html#l00034">overlaylayer.h:34</a></div></div>
<div class="ttc" id="structhwcomposer_1_1media__import_html_af82420941f64a848639e0ac80a7b2861"><div class="ttname"><a href="structhwcomposer_1_1media__import.html#af82420941f64a848639e0ac80a7b2861">hwcomposer::media_import::surface_</a></div><div class="ttdeci">VASurfaceID surface_</div><div class="ttdef"><b>Definition:</b> <a href="compositordefs_8h_source.html#l00086">compositordefs.h:86</a></div></div>
<div class="ttc" id="alios_2platformdefines_8cpp_html_a776db37da150468eb39fc6fad0d7c9c1"><div class="ttname"><a href="alios_2platformdefines_8cpp.html#a776db37da150468eb39fc6fad0d7c9c1">GetVADisplay</a></div><div class="ttdeci">void * GetVADisplay(uint32_t gpu_fd)</div><div class="ttdef"><b>Definition:</b> <a href="alios_2platformdefines_8cpp_source.html#l00003">platformdefines.cpp:3</a></div></div>
<div class="ttc" id="hwctrace_8h_html_a8f0916f7778d78a386afc1e5d8be8a25"><div class="ttname"><a href="hwctrace_8h.html#a8f0916f7778d78a386afc1e5d8be8a25">DUMPTRACE</a></div><div class="ttdeci">#define DUMPTRACE(fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="hwctrace_8h_source.html#l00087">hwctrace.h:87</a></div></div>
<div class="ttc" id="structhwcomposer_1_1__HwcDeinterlaceCap_html_ad5822e137156ac4bd12edd5a7da72e8f"><div class="ttname"><a href="structhwcomposer_1_1__HwcDeinterlaceCap.html#ad5822e137156ac4bd12edd5a7da72e8f">hwcomposer::_HwcDeinterlaceCap::caps_</a></div><div class="ttdeci">VAProcFilterCapDeinterlacing caps_[VAProcDeinterlacingCount]</div><div class="ttdef"><b>Definition:</b> <a href="varenderer_8h_source.html#l00080">varenderer.h:80</a></div></div>
<div class="ttc" id="classhwcomposer_1_1Renderer_html_aa7f5e7d36857fb67093b9f0cc3a7e606"><div class="ttname"><a href="classhwcomposer_1_1Renderer.html#aa7f5e7d36857fb67093b9f0cc3a7e606">hwcomposer::Renderer::Init</a></div><div class="ttdeci">virtual bool Init()</div><div class="ttdef"><b>Definition:</b> <a href="renderer_8h_source.html#l00041">renderer.h:41</a></div></div>
<div class="ttc" id="alios_2platformdefines_8h_html_a226d6c99e4bcfca193c095e085e9097d"><div class="ttname"><a href="alios_2platformdefines_8h.html#a226d6c99e4bcfca193c095e085e9097d">ETRACE</a></div><div class="ttdeci">#define ETRACE(fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="alios_2platformdefines_8h_source.html#l00091">platformdefines.h:91</a></div></div>
<div class="ttc" id="classhwcomposer_1_1OverlayBuffer_html"><div class="ttname"><a href="classhwcomposer_1_1OverlayBuffer.html">hwcomposer::OverlayBuffer</a></div><div class="ttdef"><b>Definition:</b> <a href="overlaybuffer_8h_source.html#l00033">overlaybuffer.h:33</a></div></div>
<div class="ttc" id="namespacehwcomposer_html_a487f8d9f8fe8490d7057be9a1c67b42e"><div class="ttname"><a href="namespacehwcomposer.html#a487f8d9f8fe8490d7057be9a1c67b42e">hwcomposer::DrmFormatToRTFormat</a></div><div class="ttdeci">int DrmFormatToRTFormat(int format)</div><div class="ttdef"><b>Definition:</b> <a href="vautils_8cpp_source.html#l00056">vautils.cpp:56</a></div></div>
<div class="ttc" id="hwctrace_8h_html_a539a95897071c72babce1012d503b3ca"><div class="ttname"><a href="hwctrace_8h.html#a539a95897071c72babce1012d503b3ca">CTRACE</a></div><div class="ttdeci">#define CTRACE()</div><div class="ttdef"><b>Definition:</b> <a href="hwctrace_8h_source.html#l00073">hwctrace.h:73</a></div></div>
<div class="ttc" id="structhwcomposer_1_1media__import_html"><div class="ttname"><a href="structhwcomposer_1_1media__import.html">hwcomposer::media_import</a></div><div class="ttdef"><b>Definition:</b> <a href="compositordefs_8h_source.html#l00084">compositordefs.h:84</a></div></div>
<div class="ttc" id="classhwcomposer_1_1OverlayBuffer_html_af12a31161149b0f89e92e5dfc18732c5"><div class="ttname"><a href="classhwcomposer_1_1OverlayBuffer.html#af12a31161149b0f89e92e5dfc18732c5">hwcomposer::OverlayBuffer::GetFormat</a></div><div class="ttdeci">virtual uint32_t GetFormat() const =0</div></div>
<div class="ttc" id="classhwcomposer_1_1NativeSurface_html_ad2dd3e317071362a6dfefe3df74d91b0"><div class="ttname"><a href="classhwcomposer_1_1NativeSurface.html#ad2dd3e317071362a6dfefe3df74d91b0">hwcomposer::NativeSurface::SetClearSurface</a></div><div class="ttdeci">void SetClearSurface(NativeSurface::ClearType clear_surface)</div><div class="ttdef"><b>Definition:</b> <a href="nativesurface_8cpp_source.html#l00110">nativesurface.cpp:110</a></div></div>
<div class="ttc" id="structhwcomposer_1_1MediaState_html_a43e040e443a44a8c5ac653f49be17dca"><div class="ttname"><a href="structhwcomposer_1_1MediaState.html#a43e040e443a44a8c5ac653f49be17dca">hwcomposer::MediaState::layer_</a></div><div class="ttdeci">const OverlayLayer * layer_</div><div class="ttdef"><b>Definition:</b> <a href="renderstate_8h_source.html#l00063">renderstate.h:63</a></div></div>
<div class="ttc" id="structhwcomposer_1_1OverlayLayer_html_a8c9e307b0c311016242bff146959a7de"><div class="ttname"><a href="structhwcomposer_1_1OverlayLayer.html#a8c9e307b0c311016242bff146959a7de">hwcomposer::OverlayLayer::GetSourceCropHeight</a></div><div class="ttdeci">uint32_t GetSourceCropHeight() const</div><div class="ttdef"><b>Definition:</b> <a href="overlaylayer_8h_source.html#l00130">overlaylayer.h:130</a></div></div>
<div class="ttc" id="classhwcomposer_1_1VARenderer_html_a5fdcb230093416433e8cf394137b9cc1"><div class="ttname"><a href="classhwcomposer_1_1VARenderer.html#a5fdcb230093416433e8cf394137b9cc1">hwcomposer::VARenderer::Draw</a></div><div class="ttdeci">bool Draw(const MediaState &amp;state, NativeSurface *surface) override</div><div class="ttdef"><b>Definition:</b> <a href="varenderer_8cpp_source.html#l00216">varenderer.cpp:216</a></div></div>
<div class="ttc" id="classhwcomposer_1_1VARenderer_html_affd21547dc812a4a39b1b5dbba33c9af"><div class="ttname"><a href="classhwcomposer_1_1VARenderer.html#affd21547dc812a4a39b1b5dbba33c9af">hwcomposer::VARenderer::~VARenderer</a></div><div class="ttdeci">~VARenderer()</div><div class="ttdef"><b>Definition:</b> <a href="varenderer_8cpp_source.html#l00031">varenderer.cpp:31</a></div></div>
<div class="ttc" id="structhwcomposer_1_1MediaState_html_addeecd9addfdd71066eac26d6ef270c3"><div class="ttname"><a href="structhwcomposer_1_1MediaState.html#addeecd9addfdd71066eac26d6ef270c3">hwcomposer::MediaState::scaling_mode_</a></div><div class="ttdeci">uint32_t scaling_mode_</div><div class="ttdef"><b>Definition:</b> <a href="renderstate_8h_source.html#l00066">renderstate.h:66</a></div></div>
<div class="ttc" id="namespacehwcomposer_html"><div class="ttname"><a href="namespacehwcomposer.html">hwcomposer</a></div><div class="ttdef"><b>Definition:</b> <a href="compositionregion_8h_source.html#l00024">compositionregion.h:24</a></div></div>
<div class="ttc" id="structhwcomposer_1_1HwcFilterCap_html_ab934d5bbd9e4f61bdafccd6d620f3e09"><div class="ttname"><a href="structhwcomposer_1_1HwcFilterCap.html#ab934d5bbd9e4f61bdafccd6d620f3e09">hwcomposer::HwcFilterCap::use_default_</a></div><div class="ttdeci">bool use_default_</div><div class="ttdef"><b>Definition:</b> <a href="varenderer_8h_source.html#l00076">varenderer.h:76</a></div></div>
<div class="ttc" id="classhwcomposer_1_1OverlayBuffer_html_a947d4a8ef39b9a1a254325e32d4a45c2"><div class="ttname"><a href="classhwcomposer_1_1OverlayBuffer.html#a947d4a8ef39b9a1a254325e32d4a45c2">hwcomposer::OverlayBuffer::GetMediaResource</a></div><div class="ttdeci">virtual const MediaResourceHandle &amp; GetMediaResource(MediaDisplay display, uint32_t width, uint32_t height)=0</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
